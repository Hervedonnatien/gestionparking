{% extends 'base.html.twig' %}

{% block title %} Proprietaire !{% endblock %}

{% block content %}
<div class="text-center" right:>
  <br /><br />
  <h4 class="text center">Liste Proprietaire Voiture</h4>
  {% for message in app.flashes('success') %}
  <div class="alert alert-success">
    {{ message }}
  </div>
  {% endfor %}
  <div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800"></h1>
    <a href="#" data-toggle="modal" data-target="#myModal"
      class="d-none d-sm-inline-block btn btn-sm btn-success shadow-sm">Ajout Proprietaire</a>
    <!-- The Modal -->
    <div class="modal" id="myModal">
      <div class="modal-dialog">
        <div class="modal-content">

          <!-- Modal body -->
          <div class="modal-body">
            <center>
              <i>
                <h4>
                  <center>Ajouter Proprietaire</center>
                </h4>
              </i>
            </center>
            {{ form_start(form) }}
            {{ form_rest(form) }}
            <button type="submit" class="btn btn-primary">Enregistrer</button>
            {{ form_end(form) }}
            <br />
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="shadow">
    <table class="table table-striped table-bordered table-hover">
      <thead class="text-dark text-center">
        <th>Nom Proprietaire</th>
        <th>Numéro Téléphone</th>
        <th>Adresse</th>
        <th>Autre Contact</th>
        <th>Action</th>
      </thead>
      <tbody>
        {% for proprietaire in proprietaire %}
        <tr>
          <td>{{ proprietaire.nomProprietaire }}</td>
          <td>{{ proprietaire.numTelephone }}</td>
          <td>{{ proprietaire.adresse }}</td>
          <td>{{ proprietaire.autreContact }}</td>
          <td>
            {% if is_granted('ROLE_ADMIN') or is_granted('ROLE_MODERATORS') %}
            <a href="#" onclick="edit({{ proprietaire.id }})" class="btn btn-secondary"
              style="font-size: 10px">Editer</a>
            {% endif %}

            <!-- The Modal -->
            <div class="modal fade" id="myModal2">
              <div class="modal-dialog">
                <div class="modal-content">

                  <!-- Modal body -->
                  <div class="modal-body">
                    <div class="#" style="padding-top: 20px">
                      <center>
                        <i>
                          <h4>
                            <center>Modification</center>
                          </h4>
                        </i>
                      </center>
                      <form name="proprietaire" method="post">
                        <div class="form-group">
                          <label for="proprietaire_nomProprietaire" class="required">Nom proprietaire</label>
                          <input type="text" id="A" name="proprietaire[nomProprietaire]" required="required"
                            maxlength="255" class="form-control">
                        </div>
                        <div class="form-group">
                          <label for="proprietaire_numTelephone" class="required">Num telephone</label>
                          <input type="text" id="B" name="proprietaire[numTelephone]" required="required"
                            maxlength="255" class="form-control">
                        </div>
                        <div class="form-group">
                          <label for="proprietaire_adresse" class="required">Adresse</label>
                          <input type="text" id="C" name="proprietaire[adresse]" required="required" maxlength="255"
                            class="form-control"></div>
                        <div class="form-group">
                          <label for="proprietaire_autreContact" class="required">Autre contact</label>
                          <input type="text" id="D" name="proprietaire[autreContact]" required="required"
                            maxlength="255" class="form-control">
                        </div>
                        <!-- <div class="form-group">
                          <label for="proprietaire_idPaiement" class="required">Id paiement</label>
                          <input type="number" id="E" name="proprietaire[idPaiement]" required="required"
                            class="form-control">
                        </div> -->
                        <div class="form-group">
                          <label for="proprietaire_numContrat" class="required">Num contrat</label>
                          <input type="number" id="F" name="proprietaire[numContrat]" required="required"
                            class="form-control">
                        </div>
                        <button type="submit" class="btn btn-primary">Enregistrer</button>
                      </form>
                      <br>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            {% if  is_granted('ROLE_ADMIN') %}
              <form method="post" action="{{ path('deleteProprietaire', { id: proprietaire.id }) }}"
                style="display: inline-block" onsubmit="return confirm('Etes-vous vraiment sûr de supprimer??')">
                <input type="hidden" name="_method" value="DELETE" />
                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ proprietaire.id) }}" />
                <button class="btn btn-danger" style="font-size: 10px">
                  Supprimer
                </button>
              </form>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
        {% if not proprietaire %}
        <tr class="text-center" style="height: 300px">
          <td colspan="7">
            <div style="margin-top: 120px">
              <code>Liste vide</code>
            </div>
          </td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>

<script>
  function edit(id) {
    $.ajax({
      url: "/proprietaire/" + id + "/edit",
    }).done(
      function (data) {
        var modal = new bootstrap.Modal(document.getElementById('myModal2'), {
          keyboard: false
        })
        $('#A').val(data.nomProprietaire);
        $('#B').val(data.numTelephone);
        $('#C').val(data.adresse);
        $('#D').val(data.autreContact);
        $('#F').val(data.numContrat);


        modal.show();
      }
    )

  }
</script>
{% endblock %}