{% extends 'base.html.twig' %}

{% block title %}Client!{% endblock %} 

{% block content %}
	<div class="text-center" right:>
	  <br /><br />
	  <h4 class="text center">Liste du Client</h4>
	  {% for message in app.flashes('success') %}
	  <div class="alert alert-success">
		{{ message }}
	  </div>
	  {% endfor %}
	  <div class="d-sm-flex align-items-center justify-content-between mb-4">
		<h1 class="h3 mb-0 text-gray-800"></h1>
		<a href="#" data-toggle="modal" data-target="#d"
		  class="d-none d-sm-inline-block btn btn-sm btn-success shadow-sm">Ajout Client</a>
		<!-- The Modal -->
		<div class="modal fade" id="d">
			<div class="modal-dialog">
				<div class="modal-content">
				<!-- Modal body -->
				<div class="modal-body">
					<center>
					<i>
						<h4>
						<center>Ajouter Client</center>
						</h4>
					</i>
					</center>
					{{ form_start(form) }}
					{{ form_rest(form) }}
					<button type="submit" class="btn btn-primary">Enregistrer</button>
					{{ form_end(form) }}
					<br />
				</div>
				</div>
			</div>
		</div>
	  </div>
	
	  <div class="shadow">
		<table class="table table-striped table-bordered table-hover">
		  <thead class="text-dark text-center">
			<th>Nom Client</th>
			<th>Type Société Client</th>
			<th>Contact</th>
			<th>Adresse</th>
			<th>Numéro Contrat</th>
			<th>Action</th>
		  </thead>
		  <tbody>
			{% for client in client %}
			<tr>
			  <td>{{ client.nomClient }}</td>
			  <td>{{ client.typeClient }}</td>
			  <td>{{ client.contactClient }}</td>
			  <td>{{ client.adresse }}</td>
			  <td>{{ client.numContrat }}</td>
			  <td>
				{% if is_granted('ROLE_ADMIN') or is_granted('ROLE_MODERATORS') %}
				<a href="#" onclick="edit({{ client.id }})" class="btn btn-secondary" style="font-size: 10px">Editer</a>
				{% endif %}
				<!-- The Modal -->
				<div class="modal" id="myModal2">
				  <div class="modal-dialog">
					<div class="modal-content">
	
					  <!-- Modal body -->
					  <div class="modal-body">
						<div class="#" style="padding-top: 20px">
						  <center>
							<i>
							  <h4>
								<center>Modification</center>
							  </h4>
							</i>
						  </center>
						  <form name="client" method="post" id="k">
							<div class="form-group">
							  <label for="client_nomClient" class="required">Nom client</label>
							  <input type="text" id="A" name="nomClient" required="required" maxlength="255"
								class="form-control"></div>
							<div class="form-group"><label class="required" for="client_typeClient">Type client</label>
							  <select id="client_typeClient" name="typeClient" class="form-control">
								<option value="SA">SA</option>
								<option value="SARL">SARL</option>
								<option value="SARLU">SARLU</option>
							  </select>
							</div>
							<div class="form-group">
							  <label for="client_contactClient" class="required">Contact client</label>
							  <input type="text" id="B" name="contactClient" required="required" maxlength="255"
								class="form-control">
							</div>
							<div class="form-group">
							  <label for="client_adresse" class="required">Adresse</label>
							  <input type="text" id="C" name="adresse" required="required" maxlength="255"
								class="form-control"></div>
							<div class="form-group">
							  <label for="client_numContrat" class="required">Num contrat</label>
							  <input type="number" id="D" name="numContrat" required="required"
								class="form-control">
							</div>
							<button type="submit" class="btn btn-primary">Enregistrer</button>
						  </form>
						  <br />
						</div>
					  </div>
					</div>
				  </div>
				</div>
				{% if  is_granted('ROLE_ADMIN') %}
				<form method="post" action="{{ path('deleteClient', { id: client.id }) }}" style="display: inline-block"
				  onsubmit="return confirm('Etes-vous vraiment sûr de supprimer??')">
				  <input type="hidden" name="_method" value="DELETE" />
				  <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ client.id) }}" />
				  <button class="btn btn-danger" style="font-size: 10px">
					Supprimer
				  </button>
				</form>
				{% endif %}
			  </td>
			</tr>
			{% endfor %}
			{% if not client %}
			<tr class="text-center" style="height: 300px">
			  <td colspan="7">
				<div style="margin-top: 120px">
				  <code>Liste vide</code>
				</div>
			  </td>
			</tr>
			{% endif %}
		  </tbody>
		</table>
	  </div>
	</div>
	<script>
	  function edit(id) {
		$.ajax({
		  url: "/client/" + id + "/edit",
		}).done(
		  function (data) {
			var modal = new bootstrap.Modal(document.getElementById('myModal2'), {
			  keyboard: false
			})
			$('#k').attr('action','/updates/' + data.id);
			$('#A').val(data.nomClient);
			$('#B').val(data.contactClient);
			$('#C').val(data.adresse);
			$('#D').val(data.numContrat);
	
			modal.show();
		  }
		)
	
	  }
	</script>
	{% endblock %}